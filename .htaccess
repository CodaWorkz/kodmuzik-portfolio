# Force HTTPS and WWW in a single redirect to avoid double hops
RewriteEngine On
RewriteBase /

# 1. Combined Redirect: Force HTTPS and WWW
# One-step canonicalization of protocol and host
RewriteCond %{HTTPS} off [OR]
RewriteCond %{HTTP_HOST} !^www\.kodmuzik\.com$ [NC]
RewriteRule ^(.*)$ https://www.kodmuzik.com/$1 [L,R=301]

# 2. English slug migration (old Turkish slugs â†’ localized English slugs)
RewriteRule ^en/hakkimizda/?$ /en/about/ [L,R=301,NC]
RewriteRule ^en/etkinlikler/?$ /en/events/ [L,R=301,NC]
RewriteRule ^en/gelecek-etkinlikler/?$ /en/upcoming-events/ [L,R=301,NC]
RewriteRule ^en/iletisim/?$ /en/contact/ [L,R=301,NC]

# 3. Remove .html extension and Redirect to Trailing Slash
# Example: /hakkimizda.html -> /hakkimizda/
RewriteCond %{THE_REQUEST} /([^/.]+)\.html [NC]
RewriteRule ^ /%1/ [L,R=301]

# 4. Force Trailing Slash on extensionless URLs (Optimized Relative Path)
# Ensures consistency: /hakkimizda -> /hakkimizda/
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_URI} !/$
RewriteRule ^(.*)$ /$1/ [L,R=301]

# 5. Internal Rewrites (Serves .html content while keeping the clean URL)
# Turkish pages
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.html -f
RewriteRule ^([^/]+)/$ $1.html [L]

# English folder pages
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{DOCUMENT_ROOT}/en/$1\.html -f
RewriteRule ^en/([^/]+)/$ en/$1.html [L]

# 6. Modern Security Headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
</IfModule>

# MIME Types
AddType application/json .json
AddType image/svg+xml .svg .svgz
AddEncoding gzip .svgz

# UTF-8 Encoding
AddDefaultCharset UTF-8

# Prevent directory browsing
Options -Indexes